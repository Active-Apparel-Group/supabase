# Supabase Declarative Schema Reference

This document summarizes the declarative schema approach in Supabase, including SQL examples, migration workflows, and best practices for managing schema as code.

---

## Contents
- What is a Declarative Schema?
- Example: Table Definition
- Example: Schema Diff & Migration
- Example: Schema File Organization
- Example: RLS & Views
- Example: JSON Schema Validation
- CLI Commands for Schema Management

---

## What is a Declarative Schema?
A declarative schema is a source-of-truth SQL file (or set of files) that describes the desired state of your database. Supabase can generate migrations by diffing this schema against the current database state, making schema evolution safe and auditable.

---

## Example: Table Definition
```sql
create table "products" (
  id         bigint generated by default as identity,
  name       text not null,
  category   text,
  price      numeric(10, 2) not null,
  created_at timestamptz default now()
);

alter table "products"
enable row level security;
```

---

## Example: Schema Diff & Migration
```bash
supabase db diff -f add_metadata_column
```

---

## Example: Schema File Organization
```toml
[db.migrations]
schema_paths = [
  "./schemas/employees.sql",
  "./schemas/*.sql",
]
```

---

## Example: RLS & Views
```sql
create table private.projects (
  id              bigint    not null,
  name            text      not null,
  organization_id bigint    not null,
  inserted_at     timestamp not null,
  updated_at      timestamp not null
);

alter table private.projects
enable row level security;

create view public.projects as select
  projects.id,
  projects.name,
  projects.organization_id,
  projects.inserted_at,
  projects.updated_at
from private.projects
where auth.can_read(projects.id);
```

---

## Example: JSON Schema Validation
```sql
create table customers (
  id serial primary key,
  metadata json
);

alter table customers
add constraint check_metadata check (
  json_matches_schema(
    '{
        "type": "object",
        "properties": {
            "tags": {
                "type": "array",
                "items": {
                    "type": "string",
                    "maxLength": 16
                }
            }
        }
    }',
    metadata
  )
);
```

---

## CLI Commands for Schema Management
- Dump production schema: `supabase db dump > supabase/schemas/prod.sql`
- Generate migration: `supabase db diff -f <migration_name>`
- Apply migrations: `supabase db push`
- Reset local DB: `supabase db reset --version <version>`

---

[See Supabase docs for more on declarative schemas.]
